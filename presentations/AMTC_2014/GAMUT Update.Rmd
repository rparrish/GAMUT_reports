---
title: "GAMUT Update"
author: "GAMUT Database"
date: "Sunday, Sept 7, 2014"
output:
  beamer_presentation:
    fig_height: 6
    fig_width: 7
    highlight: espresso
    keep_tex: yes
    slide_level: 2
    theme: Marburg
    toc: no
  ioslides_presentation:
    fig_caption: yes
---

```{r setup, include=FALSE}
require(knitr)
opts_chunk$set(dev = 'pdf')
options(scipen = 4)
```


```{r load data, include=FALSE, echo=FALSE}
library(GAMUT)

## Refresh data - best to run manually once when refreshing reports/slides
# save_metricData()

## load data
load("../../data/GAMUT.Rdata")

```

# Participation
## GAMUT Overview
```{r overview, echo=FALSE}
reporting <- table(mydata$program_name)
total.enrolled <- length(reporting)
total.not_reporting <- length(reporting[reporting == 0])
total.reporting <- length(reporting[reporting > 0])
total.partial <- length(reporting[reporting > 0 & reporting <= 3])
total.full <- length(reporting[reporting >=7])

```  

### `r total.enrolled` total programs enrolled  
 
 - `r total.reporting` reporting data   
 - `r total.not_reporting` not reporting data   

 - `r total.full` reporting all of 2014 YTD 
 
```{r hist_reporting, fig.path="figures/", fig.height=3.5, include=TRUE, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}
hist(reporting, 
     main="",
     xlab="number of months reported")

```

## Patients
### `r sum(metricData$total_patients)` Total Patients   

 - `r sum(metricData$total_neo_patients)` Neonatal   
 - `r sum(metricData$total_peds_patients)` Pediatric  
 - `r sum(metricData$total_adult_patients)` Adult  

Data as of  : `r GAMUT_date_loaded`


# Advanced Airway Management
## Mechanical Ventilation
```{r vent_adv_airway, fig.path="figures/", include=TRUE, fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$adv_airway_cases > 0 & metricData$adv_airway_cases >= metricData$adv_airway_ventilator,
                       c("group", "adv_airway_ventilator", "adv_airway_cases")]
colnames(plotData) <- c("group", "num", "den")


metric.table <- plot_metrics(
    "Percent of patient transport contacts with 
    an advanced airway supported by a mechanical ventilator",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Waveform Capnography
```{r waveform_capno, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$adv_airway_cases > 0,
                       c("group", "adv_airway_wave_capno", "adv_airway_cases")]
colnames(plotData) <- c("group", "num", "den")


metric.table <- plot_metrics(
    "Percent of patient transport contacts with advanced airways
 in whom continuous waveform capnography was used.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Confirmed tracheal tube placement
```{r confirmed_tt, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$adv_airway_tt_cases > 0,
                       c("group", "adv_airway_tt_confirmed", "adv_airway_tt_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of intubated patient transport contacts 
with documentation of confirmed tracheal tube placement.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```

# Intubation
## Neonatal - First Attempt Success
```{r first_attempt_success_neo,  eval=FALSE, fig.path="figures/", include=TRUE, fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$intub_neo_attempts > 0,
                       c("group", "intub_neo_first_success", "intub_neo_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Neonatal - Percent of patient transport contacts successfully intubated 
    on the 1st attempt by the transport team",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot

```

## Neonatal - DASH-1A
```{r DASH1A_neo, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_neo_attempts > 0,
                       c("group", "intub_neo_no_hypoxia", "intub_neo_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Neonatal - Percent of patients with definitive airway during the 1st attempt 
    by the transport team without suffering hypoxia or hypotension",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Pediatric - First Attempt Success
```{r first_attempt_success_ped, eval=FALSE, fig.path="figures/", include=TRUE, fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_ped_attempts > 0,
                       c("group", "intub_ped_first_success", "intub_ped_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Pediatric - Percent of patient transport contacts successfully intubated 
    on the 1st attempt by the transport team",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Pediatric - DASH-1A 
```{r DASH1A_ped, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_ped_attempts > 0,
                       c("group", "intub_ped_no_hypoxia", "intub_ped_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Pediatric - Percent of patients with definitive airway during the 1st attempt 
    by the transport team without suffering hypoxia or hypotension",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Adult - First Attempt Success
```{r first_attempt_success_adult, eval=FALSE, fig.path="figures/", include=TRUE, fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_adult_attempts > 0,
                       c("group", "intub_adult_first_success", "intub_adult_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Adult - Percent of patient transport contacts successfully intubated 
    on the 1st attempt by the transport team",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Adult DASH-1A
```{r DASH1A_adult, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_adult_attempts > 0,
                       c("group", "intub_adult_no_hypoxia", "intub_adult_attempts")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Adult - Percent of patients with definitive airway during the 1st attempt 
    by the transport team without suffering hypoxia or hypotension",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## RSI protocol compliance
```{r RSI_compliance, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


plotData <- metricData[metricData$intub_rsi_cases > 0,
                       c("group", "intub_rsi_compliant", "intub_rsi_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of patient transport contacts undergoing RSI 
where all indicated elements of the programâ€™s RSI protocol were completed.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```










# General Metrics
## Reliable pain assessments
```{r pain_assessment, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "pain_scale_used", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of patient transport contacts with a 
documented pain assessment.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Incidence of hypoxia during transport   

### NUMERATOR:  
Number of patient transport contacts during which the documented 
pulse oximetry reading drops below 90%.  

Multiple incidents with one patient are 
considered as one incident. If the pulse oximetry reading is chronically low or is below 
90% when contact is made, the patient is not included except for those patients where 
the saturation has been corrected to greater than 90% and falls again. 

### DENOMINATOR:  
Number of patient transport contacts during the calendar month 
(excluding those with chronic oxygen saturations lower than 90% or oxygen saturations 
lower than 90% that persist throughout the entire transport).

```{r incidence_hypoxia, include=TRUE, results='asis', fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$hypoxia_event_cases >= 0,
                       c("ID", "hypoxia_events", "hypoxia_event_cases")]
colnames(plotData) <- c("group", "num", "den")

# metric.table <- plot_metrics(
#     "Percent of patient transport contacts experiencing 
# transport-related hypoxia.",
#                              program_name = plotData$group,
#                              num = plotData$num,
#                              den = plotData$den,
#                              reordering = "decreasing"
#                              )
#metric.table$plot
#kable(plotData)

```
## Incidence of hypoxia during transport   

```{r incidence_hypoxia1, include=TRUE, results='asis', fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}
kable(plotData[1:7,], row.names=FALSE)  

```

## Incidence of hypoxia during transport  

```{r incidence_hypoxia2, include=TRUE, results='asis', fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}
kable(plotData[8:14,], row.names=FALSE)

```

## Incidence of hypoxia during transport  

```{r incidence_hypoxia3, include=TRUE, results='asis', fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}
kable(plotData[15:20, ], row.names=FALSE)

```


## HEMS Over-triage
```{r hems_over_triage, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$hems_cases > 0,
                       c("group", "hems_ed_discharge", "hems_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of the HEMS patient transport contacts 
discharged without hospital admission",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


# Focused Populations
## Neonatal Hypothermia on Arrival
```{r neonatal_hypothermia, fig.cap="",  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_neo_patients > 0 & !is.na(metricData$unintended_hypothermia),
                       c("group", "unintended_hypothermia", "total_neo_patients")]

metric.table <- plot_metrics("Percent of neonates found \nhypothermic upon admission",
                             program_name = plotData$group,
                             num = plotData$unintended_hypothermia,
                             den = plotData$total_neo_patients,
                             reordering = "increasing"
                             )
metric.table$plot
```


## STEMI Bedside
```{r bedside_stemi, fig.cap="",  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}
rate.overall <- weighted.mean(mydata$mean_bedside_stemi, mydata$stemi_cases, na.rm=TRUE)

metric.table <- plot_metrics_wm(
    "Average bedside time for 
STEMI activation patients",
                             program_name = bedside_stemi$group,
                             wavg = bedside_stemi$bedside_stemi.wavg,
                             rate_overall= rate.overall,
                             reordering="increasing",
                             qlabel="Weighted average* time in minutes"
                             )

#metric.table$plot
```

## STEMI Scene
```{r scene_stemi, fig.cap="",  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

rate.overall <- weighted.mean(mydata$mean_scene_stemi, mydata$stemi_cases, na.rm=TRUE)

metric.table <- plot_metrics_wm(
    "Average scene time for 
STEMI activation patients",
                             program_name = scene_stemi$group,
                             wavg = scene_stemi$scene_stemi.wavg,
                             rate_overall= rate.overall,
                             reordering="increasing",
                             qlabel="Weighted average* time in minutes"
                             )

#metric.table
```

## ECG interpretation for STEMI patients

```{r ecg_stemi, include=TRUE,  fig.path="figures/", fig.cap="Data only reported for one  month by 1 program", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$ecg_cases > 0,
                       c("group", "ecg_accurate_interpret", "ecg_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of transport patient contacts with accurately 
interpreted 12-lead ECG evaluations",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```

## Blood glucose check for altered mental status  
```{r bg_check, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$alt_ment_cases > 0,
                       c("group", "alt_ment_bg_checks", "alt_ment_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of patient transport contacts with altered mental status 
    or focal neurologic deficit with a documented blood glucose check.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```


## Management of hypertension in hemorrhagic stroke
```{r htn_hem_stroke, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$hem_stroke_cases > 0,
                       c("group", "hem_stroke_bp_managed", "hem_stroke_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of transport patient contacts with 
hemorrhagic stroke and appropriate blood pressure management",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```

## Appropriate management of hemorrhagic shock
```{r hem_shock_managed, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$hem_shock_cases > 0,
                       c("group", "hem_shock_managed", "hem_shock_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of patient transport contacts with 
hemorrhagic shock appropriately managed",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```

## Appropriate management of blood pressure for aortic emergencies
```{r bp_aortic, include=TRUE,  fig.path="figures/", fig.height=4, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$aortic_dissect_cases > 0,
                       c("group", "aortic_dissect_managed", "aortic_dissect_cases")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Percent of patient transport contacts with known or suspected 
    aortic dissection receiving indicated blood pressure and heart rate therapies.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing"
                             )
metric.table$plot
```



# Rare Events
## Medical equipment failure
```{r med_equip_failure, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "med_equip_failure", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Medical equipment failures 
    per 1000 patient transport contacts.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 1000",
                             qlabel = "Estimated cases per 1000"
                             )
metric.table$plot
```

## Adverse drug event during transport
```{r ade, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "ade", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Adverse drug events 
    per 1000 patient transport contacts",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 1000",
                             qlabel = "Estimated cases per 1000"
                             )
metric.table$plot
```

## Patient near-miss events 
```{r nearmiss, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "near_miss", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "(Rolling 12 month) transport-related patient mishap rate 
    per 10,000 patient transport contacts",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 10000",
                             qlabel = "Estimated cases per 10000"
                             )
metric.table$plot
```

## Rate of Serious Reportable Event
```{r sre, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "sre", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "(Rolling 12 month) SRE rate 
    per 10,000 patient transport contacts",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 10000",
                             qlabel = "Estimated cases per 10000"
                             )
metric.table$plot
```

## Unplanned device dislodgements
```{r device_dislogement, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "dislodgements", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "Unplanned dislodgements of therapeutic devices 
    per 1000 patient transport contacts",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 1000",
                             qlabel = "Estimated cases per 1000"
                             )
metric.table$plot
```

## Medication errors on transport
```{r med_error, include=TRUE,  fig.path="figures/", fig.height=6, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

plotData <- metricData[metricData$total_patients > 0,
                       c("group", "medication_errors", "total_patients")]
colnames(plotData) <- c("group", "num", "den")

metric.table <- plot_metrics(
    "(Rolling 12 month) medication error rate 
    per 10,000 patient transport contacts.",
                             program_name = plotData$group,
                             num = plotData$num,
                             den = plotData$den,
                             reordering = "increasing",
                             rate = "per 10000",
                             qlabel = "Estimated cases per 10000"
                             )
metric.table$plot
```


