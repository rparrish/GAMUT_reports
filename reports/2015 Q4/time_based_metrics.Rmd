---
title: "GAMUT 2015 Summary Report"
author: ''
date: '`r paste(params$program_name)`'
output:
  pdf_document:
    highlight: tango
    includes:
      in_header: header.tex
    toc: no
  html_document:
    toc: no
  fontsize: 11pt
params:
  dag: Akron Childrens
  end_date: '2016-01-01'
  operator: ''
  program_name: Akron Childrens
  start_date: '2015-01-01'
---


```{r initial_setup, echo=FALSE, message=FALSE, warning=FALSE}
library(REDCapR)
library(knitr)
library(plyr)
library(dplyr)
library(magrittr)
library(GAMUT)
library(zoo)
library(beeswarm)


options(scipen = 10)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, comment = "")


source('beeswarm_plot.R')
source('beeswarm_plot_1k.R')
source('beeswarm_plot_10k.R')


# Shadowtest: adds white around text label
# http://stackoverflow.com/questions/25631216/r-is-there-any-way-to-put-border-shadow-or-buffer-around-text-labels-en-r-plot

shadowtext <- function(x, y=NULL, labels, col='white', bg='black', 
                       theta= seq(0, 2*pi, length.out=50), r=0.1, ... ) {

    xy <- xy.coords(x,y)
    xo <- r*strwidth('A')
    yo <- r*strheight('A')

    # draw background text with small shift in x and y in background colour
    for (i in theta) {
        text( xy$x + cos(i)*xo, xy$y + sin(i)*yo, labels, col=bg, ... )
    }
    # draw actual text in exact xy position in foreground colour
    text(xy$x, xy$y, labels, col=col, ... )
}


```
```{r load_data}
# Uncomment next line to get new data from REDCap
#GAMUT_data("GAMUT.Rdata")
load("GAMUT.Rdata")

# Filter 
monthly_data <- filter(monthly_data,
                       month >= params$start_date & 
                       month < params$end_date)

dag <- params$dag
operator <- params$operator

```

\pagestyle{fancy}
\fancyheadoffset{0cm}
\rhead{}
\lhead{`r dag`}
\chead{GAMUT 2015 Summary Report}
\cfoot{Confidential report for quality improvement purposes}
\fancyfoot[LE,RO]{\thepage}

\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

\thispagestyle{empty}
\begin{center}
%\Large{`r paste(dag, ifelse(operator == "AIM", "Air Methods", ""))`}
\vfill
`r paste("Report generated on ", Sys.Date())`

\end{center}  



\newpage  

# Time-based Metrics


## STEMI Times

```{r bedside_stemi, fig.path="figures/", fig.height=8, eval=TRUE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}


main = "Average bedside time for STEMI activation patients"

```

```{r scene_stemi, fig.cap="",  fig.path="figures/", fig.height=10, eval=FALSE, message=FALSE, echo=FALSE, warning=FALSE, error=FALSE}

main = "Average scene time for STEMI activation patients"

```

## Response Times
